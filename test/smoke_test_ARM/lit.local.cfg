# -*- Python -*-

# Check if ARM target is part of LLVM and tools build
if not 'ARM' in config.targets_to_build:
    config.unsupported = True
else:
    if 'linux' == sys.platform:
        config.substitutions.extend((
            ('%cparams', "-target arm-linux-gnu"),
            ('%mparams', ""),
            ('%run-elf', "")
        ))
    elif 'darwin' == sys.platform:
        TOOLCHAIN = 'ARM_TOOLCHAIN'

        env = os.environ.get(TOOLCHAIN)
        if env is not None and env != "":
            config.suffixes = ['.c']
            # define toolchain substitution
            config.substitutions.append(('%toolchain', os.environ.get(TOOLCHAIN)))
            # define target params for clang  -Wno-override-module
            m_target = f"-target arm-linux-gnueabihf --sysroot { os.environ.get(TOOLCHAIN) }"
            config.substitutions.append(('%c-target', f"{ m_target } -fuse-ld=lld"))
            # define target params for clang
            config.substitutions.append(('%m-target', m_target))
            # define run command
            config.substitutions.append(('%run-elf',
              f"{ os.path.dirname(__file__) }/run-elf-arm.sh"))
        else:
            print(f"!! environment { TOOLCHAIN } not defined - compilation for ARM target not available !!\n"
                  "minimal prepared toolchain in the https://github.com/sv99/llvm-mctoll-toolchains")
            config.unsupported = True
