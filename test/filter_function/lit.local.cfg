# -*- Python -*-

config.suffixes = ['.c']
if not config.enable_assertions:
   config.unsupported = True

if 'linux' == sys.platform:
   config.substitutions.extend((
      ('%cparams', "-target x86_64-linux-gnu"),
      ('%mparams', ""),
   ))

elif 'darwin' == sys.platform:
   # on osx for compiling elf binary need linux toolchain
   # for more information https://github.com/microsoft/llvm-mctoll/blob/master/doc/sysroot_flag.md
   TOOLCHAIN = 'LINUX_TOOLCHAIN'

   env = os.environ.get(TOOLCHAIN)
   if env is not None and env != "":
      config.suffixes = ['.c']
      # define clang params for build linux binary
      common_params = f"-target x86_64-linux-gnu --sysroot { os.environ.get(TOOLCHAIN) }"
      config.substitutions.extend((
         ('%cparams', f"{ common_params } -fuse-ld=lld"),
         ('%mparams', common_params),
      ))
   else:
      print(f"!! environment { TOOLCHAIN } not defined - compilation for Linux target not available !!\n"
            "minimal prepared toolchain in the https://github.com/sv99/llvm-mctoll-toolchains\n"
            "test/smoke_test disabled")
      config.unsupported = True
